\subsection{Finita element av inkompressibel fluid}

För att lösa Navier-Stokes ekvationer kan lämpligen en datormodell användas.
Här består denna modell av ett system uppsatt med Galerkins metod.
I denna lösning så begränsar vi dock oss till att enbart behandla statiska flöden
vilket genomförs genom att sätta alla tidsderivator till noll.

För att hantera trycket i \eqref{eq:convection:continuity}-\eqref{eq:convection:energy} används den tidigare nämnda Boussinesq approximation
samt penalty metoden för att göra hastighetsvektorn källfri och uppfylla
kontinuitetsekvationen. Det finns således inget direkt behov av att räkna ut trycket.
Vid användning av många sorters elementtyper som inte uppfyller Babuska-Brezzikriteriet
är detta dessutom nödvändigt då det annars kan bildas oönskade trycknoder. 
En annan möjlighet är att välja divergensfria element. \cite{babuska1973}\cite{segal2011}

Genom penaltymetoden beskrives här trycket som $p$ enligt ekvation
\eqref{eq:femconvection:penalty}. Här är $p_s$ någon form av idealt statiskt
tryck som är önskat. Detta tryck följer Boussinesq approximation.
\cite{heinrich88}\cite{taylor79}
Som kan ses leder den godtyckliga penaltyparametern $\lambda$ till att justera trycket
om hastighetsfältets divergens ej är identiskt noll. I viss litteratur anges 
det att penaltyparametern skall vara i storleksordningen $10^7$ men att den
är väldigt applikationsberoende. En för liten vald penaltyparameter leder till att
trycket inte elimineras. Andra problem uppstår vid en för stor parameter. Ekvationssystemet
kan bli svårlöst och få stabilitetsproblem när parametern blir
för stor i jämförelse med de andra delarna i differentialekvationen.\cite{reddy93}\cite{roy05}\cite{basak04}\cite{segal2011}

\begin{equation}
\label{eq:femconvection:penalty}
p = p_s - \lambda\nabla\cdot\mathbf{v}
\end{equation}

\noindent
Fortsatt skall trycket deriveras med avseende på de rumsliga variablerna vilket möjliggör
att eliminera trycket från differentialekvationerna. Dessa deriveringar kan ses i ekvation
\eqref{eq:femconvection:partx} samt \eqref{eq:femconvection:partz}.
Notera att det statiska trycket
$p_s$ ej beror på $x$ vilket resulterar i att derivatan är noll.

\begin{align}
\label{eq:femconvection:partx}
\frac{\partial p}{\partial x} &= \frac{\partial p_s}{\partial x} -
\frac{\partial}{\partial x} \lambda\nabla\cdot\mathbf{v} = -
\frac{\partial}{\partial x} \lambda\nabla\cdot\mathbf{v}
\\
\label{eq:femconvection:partz}
\frac{\partial p}{\partial z} &= \frac{\partial p_s}{\partial z} -
\frac{\partial}{\partial z} \lambda\nabla\cdot\mathbf{v} =
-g\rho_0 - \frac{\partial}{\partial z} \lambda\nabla\cdot\mathbf{v}
\end{align}

\noindent
Detta förs in i momentekvationerna vilket ger ekvationerna \eqref{eq:femconvection:u} -
\eqref{eq:femconvection:T} vilket är det ekvationssystem $\mathbf{L}(u,w,T) = 0$
som syftas att bli evaluerat.

\begin{align}
\label{eq:femconvection:u}
\mathbf{v}\cdot\nabla u -
\frac{\lambda}{\rho_0}\frac{\partial}{\partial x}\nabla\cdot\mathbf{v} -\nu\Delta u &= 0
\\
\label{eq:femconvection:w}
\mathbf{v}\cdot\nabla w -
\frac{\lambda}{\rho_0}\frac{\partial}{\partial z}\nabla\cdot\mathbf{v}
- \nu\Delta w - g\beta(T-T_0) &= 0 \\ 
\label{eq:femconvection:T}
\mathbf{v}\cdot\nabla T - \alpha\Delta T &= 0
\end{align}

\subsubsection{Svag formulering}

En finita elementlösning med Galerkins metod kräver att problemet reduceras till
ett ekvivalent variationsproblem. 
Här är $\mathbf{L}$ är differentialoperatorn
som betecknar systemet av differentialekvationer \eqref{eq:femconvection:u}-
\eqref{eq:femconvection:T} som $\mathbf{L}(T,u,w) = 0$.
$\Phi$ är rummet av alla testfunktioner $\phi$ som är kontinuerliga i
definitionsmängden $\Omega$ samt vars derivator är bitvis kontinuerliga på randen
$\Gamma$. Testfunktionerna $\phi \in \Phi$ måste även vara $L^2$ integrabla.
Variationsproblemet blir då: Sök $T\in\Phi$, $u\in\Phi$ och
$w\in\Phi$ som uppfyller ekvation \eqref{eq:femconvection:variation}. Det är tydligt
att alla $(u,w,T)$ som uppfyller $\mathbf{L}(u,w,T) = 0$ är ortogonala mot alla
$L^2$ integrabla testfunktioner ty integranden kommer då alltid vara identiskt noll.

\begin{equation}
\label{eq:femconvection:variation}
\int_\Omega \mathbf{L}(T,u,w) \phi d\Omega = 0\mbox{,  } \forall \phi \in \Phi
\end{equation}

\noindent
Då differentialekvationerna innehåller andra ordningens deriveringsoperatorer i form av
partialderiveringsoperatorn samt divergensoperatorn behövs det lite analys.
Divergensteoremet i två dimensioner \eqref{eq:femconvectiongausstheorem}
med $\mathbf{A} = (uw, 0)$ eller $\mathbf{A} = (0, uw)$ ger då ekvation
\eqref{eq:femconvection:partint}. Slutligen summeras uttrycket över alla
$k$ för att få \eqref{eq:femconvection:green}. Här är $w$ utbytt mot $w_i$ med
påståendet att $\mathbf{w} = (w_1, w_2) = \nabla v$. \cite{johnson2009}

\begin{equation}
\label{eq:femconvectiongausstheorem}
\int_\Omega \nabla\cdot \mathbf{A} d\Omega = \int_\Gamma \mathbf{A}\cdot\mathbf{n} d\Gamma
\end{equation} 

\begin{equation}
\label{eq:femconvection:partint}
\int_\Omega w\frac{\partial u}{\partial x_k} d\Omega +
\int_\Omega u\frac{\partial w}{\partial x_k} d\Omega =
\int_\Gamma uwn_k d\Gamma\mbox{,   }k=1,2
\end{equation}

\begin{equation}
\label{eq:femconvection:green}
\int_\Omega u\Delta v d\Omega =
\int_\Gamma u\nabla v\cdot\mathbf{n}d\Gamma-\int_\Omega \nabla v\cdot\nabla u d\Omega
\end{equation}

\noindent
Med hjälp av ovanstående uttryck kan nu differentialekvationerna föras in i
ekvation \eqref{eq:femconvection:variation} på ett meningsfullt sätt. Detta är genomfört i 
ekvationerna \eqref{eq:femconvection:weaku}-\eqref{eq:femconvection:weakT}.

\begin{align}
\int_\Omega \left(\phi\mathbf{v}\cdot\nabla u +
\frac{\partial \phi}{\partial x}\frac{\lambda}{\rho_0}\nabla\cdot\mathbf{v}
+\nu\nabla\phi\nabla u\right)d\Omega = \nonumber \\
\int_\Gamma\left( \nu\phi\nabla u\cdot\mathbf{n} +
n_x\frac{\lambda}{\rho_0}\phi\nabla\cdot\mathbf{v}\right)d\Gamma
\label{eq:femconvection:weaku}
\end{align}
\begin{align}
\int_\Omega\left(\phi\mathbf{v}\cdot\nabla w
+ \frac{\partial \phi}{\partial z} \frac{\lambda}{\rho_0}\nabla\cdot\mathbf{v}
+ \nu\nabla\phi\cdot\nabla w + \phi\beta(T_0-T)\right)d\Omega
= \nonumber \\
\int_\Gamma\left(\nu\phi\nabla w\cdot\mathbf{n} +
n_z\phi\frac{\lambda}{\rho_0}\nabla\cdot\mathbf{v}\right)d\Gamma
\label{eq:femconvection:weakw}
\end{align}
\begin{equation}
\int_\Omega\left(\phi\mathbf{v}\cdot\nabla T + \alpha\nabla\phi\nabla T\right)d\Omega
= \int_\Gamma \alpha\phi\nabla T\cdot\mathbf{n}d\Gamma
\label{eq:femconvection:weakT}
\end{equation}



\subsubsection{Galerkinformulering}

Ansätt en lösning på formen \eqref{eq:femconvection:ansatz}.
Då $\phi_k \in \Phi$, $k=1,2,..,N$ så uppfylls även att $u,w$ och $T$ tillhör
$\Phi$ då dessa är en linjärkombination av basen $\phi_k$. Om konstanterna
är dimensionerade så att dessa uppfyller $\mathbf{L}(u,w,T) = 0$ är detta
en lösning till variationsproblemet. \cite{johnson2009}\cite{heath2002}\cite{lewis04}

\begin{align}
u(x,z) &= \sum^N_{k=1}u_k\phi_k(x,z)
\nonumber \\
w(x,z) &= \sum^N_{k=1}w_k\phi_k(x,z)
\nonumber \\
T(x,z) &= \sum^N_{k=1}T_k\phi_k(x,z)
\label{eq:femconvection:ansatz}
\end{align}

\noindent
Ansatsen kan nu sättas in i den svaga formuleringen.
Alla förekomster av $\phi$ byts ut mot $\phi_i$ med $i=1,2,..,N$. Då
kontinuitetskriteriet \eqref{eq:convection:continuity} säger att
$\nabla\cdot\mathbf{v} = 0$ sätts detta på randen vilket ger att den
ena termen i högerhandsintegralerna som ekvation \eqref{eq:femconvection:weaku} och
\eqref{eq:femconvection:weakw}
försvinner. Slutligen ger
detta galerkinformuleringen
\eqref{eq:femconvection:galerkinu}-\eqref{eq:femconvection:galerkinT}.

\begin{align}
\label{eq:femconvection:galerkinu}
\sum^N_{j=1}\sum^N_{k=1}u_ju_k\int_\Omega \phi_i\phi_j\nabla\phi_k d\Omega &+
\sum^N_{j=1}\sum^N_{k=1}w_ju_k\int_\Omega \phi_i\phi_j\nabla\phi_k d\Omega  \\ +
\nonumber
\sum^N_{j=1} u_j\int_\Omega\frac{\lambda}{\rho_0}\frac{\partial \phi_i}{\partial x}\frac{\partial \phi_j}{\partial x} d\Omega &+
\sum^N_{j=1} w_j\int_\Omega\frac{\lambda}{\rho_0}\frac{\partial \phi_i}{\partial x}\frac{\partial \phi_j}{\partial z} d\Omega  \\ +
\nonumber
\sum^N_{j=1} u_j \int_\Omega \nu\nabla\phi_i\nabla\phi_j d\Omega &=
\int_\Gamma \nu\phi_i\nabla u \cdot \mathbf{n} d\Gamma
\end{align}

\begin{align}
\label{eq:femconvection:galerkinw}
\sum^N_{j=1}\sum^N_{k=1}u_jw_k\int_\Omega \phi_i\phi_j\nabla\phi_k d\Omega &+
\sum^N_{j=1}\sum^N_{k=1}w_jw_k\int_\Omega \phi_i\phi_j\nabla\phi_k d\Omega \\ +
\nonumber
\sum^N_{j=1} u_j\int_\Omega \frac{\lambda}{\rho_0}\frac{\partial \phi_i}{\partial z}\frac{\partial \phi_j}{\partial x} d\Omega &+
\sum^N_{j=1} w_j\int_\Omega \frac{\lambda}{\rho_0}\frac{\partial \phi_i}{\partial z}\frac{\partial \phi_j}{\partial z} d\Omega \\ +
\nonumber
\sum^N_{j=1} w_j \int_\Omega \nu\nabla\phi_i\nabla\phi_j d\Omega &+
\sum^N_{j=1}T_j \int_\Omega - \beta\phi_i\phi_j d\Omega \\
\nonumber
= \int_\Gamma \nu\phi_i\nabla w \cdot \mathbf{n} d\Gamma &- \int_\Omega T_0\beta\phi_id\Omega
\end{align}

\begin{align}
\label{eq:femconvection:galerkinT}
\sum^N_{j=1}\sum^N_{k=1}u_jT_k\int_\Omega \phi_i\phi_j\nabla\phi_k d\Omega &+
\sum^N_{j=1}\sum^N_{k=1}w_jT_k\int_\Omega \phi_i\phi_j\nabla\phi_k d\Omega \\ +
\nonumber
\sum^N_{j=1} T_j \int_\Omega \alpha\nabla\phi_i\nabla\phi_j d\Omega &=
\int_\Gamma \alpha\phi_i\nabla w \cdot \mathbf{n} d\Gamma
\end{align}




